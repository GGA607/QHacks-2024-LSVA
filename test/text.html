<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Speech Recorder</title>
  </head>
  <body>
    <button id="startRecording">Start Recording</button>
    <button id="stopRecording" disabled>Stop Recording</button>
    <a id="downloadLink" style="display: none">Download Recording</a>

    <script>
      const startRecordingButton = document.getElementById("startRecording");
      const stopRecordingButton = document.getElementById("stopRecording");
      const downloadLink = document.getElementById("downloadLink");
      let mediaRecorder;
      let audioChunks = [];

      startRecordingButton.addEventListener("click", startRecording);
      stopRecordingButton.addEventListener("click", stopRecording);

      function startRecording() {
        navigator.mediaDevices
          .getUserMedia({ audio: true })
          .then((stream) => {
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = (event) => {
              if (event.data.size > 0) {
                audioChunks.push(event.data);
              }
            };

            mediaRecorder.onstop = () => {
              const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
              const audioUrl = URL.createObjectURL(audioBlob);
              downloadLink.href = audioUrl;
              downloadLink.download = "input.wav";
              downloadLink.style.display = "block";

              // Send audio file to backend
              sendAudioToBackend(audioBlob);
            };

            mediaRecorder.start();
            startRecordingButton.disabled = true;
            stopRecordingButton.disabled = false;
          })
          .catch((error) => {
            console.error("Error accessing microphone:", error);
          });
      }

      function stopRecording() {
        if (mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          startRecordingButton.disabled = false;
          stopRecordingButton.disabled = true;
        }
      }

      function sendAudioToBackend(audioBlob) {
        const formData = new FormData();
        formData.append("audioFile", audioBlob, "recorded-speech.wav");

        fetch("YOUR_BACKEND_ENDPOINT", {
          method: "POST",
          body: formData,
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Failed to upload audio file to the backend.");
            }
            console.log("Audio file successfully uploaded to the backend.");
          })
          .catch((error) => {
            console.error("Error uploading audio file to the backend:", error);
          });
      }
    </script>
  </body>
</html>
